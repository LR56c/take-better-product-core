generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  name      String?
  role      String
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@map("users")
}

model Brand {
  id        String    @id @default(uuid())
  name      String
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  products  Product[]

  @@map("brands")
}

model Country {
  id        String    @id @default(uuid())
  name      String
  code      String
  currency  String
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  stores    Store[]

  @@map("countries")
}

enum StoreType {
  supermarket
  pharmacy
  technology
  clothes
  pets
  library
}

model Store {
  id              String          @id @default(uuid())
  countryId       String          @map("country_id")
  country         Country         @relation(fields: [countryId], references: [id])
  name            String
  url             String?
  thumbnail       String?
  type            StoreType
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  products        Product[]
  storeCategories StoreCategory[]

  @@map("stores")
}

model Category {
  id              String          @id @default(uuid())
  name            String
  slug            String
  parentId        String?         @map("parent_id")
  parent          Category?       @relation("CategoryToCategory", fields: [parentId], references: [id])
  children        Category[]      @relation("CategoryToCategory")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  products        Product[]
  storeCategories StoreCategory[]

  @@map("categories")
}

model Product {
  id                String             @id @default(uuid())
  storeId           String             @map("store_id")
  store             Store              @relation(fields: [storeId], references: [id])
  brandId           String?            @map("brand_id")
  brand             Brand?             @relation(fields: [brandId], references: [id])
  categoryId        String?            @map("category_id")
  category          Category?          @relation(fields: [categoryId], references: [id])
  externalId        String             @map("external_id")
  url               String
  title             String
  description       String?
  price             Decimal
  currency          String
  additionalData    Json?              @map("additional_data")
  lastScrapedAt     DateTime           @map("last_scraped_at")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  priceHistory      PriceHistory[]
  images            ProductImage[]
  productEmbeddings ProductEmbedding[]

  @@map("products")
}

model PriceHistory {
  id         String   @id @default(uuid())
  productId  String   @map("product_id")
  product    Product  @relation(fields: [productId], references: [id])
  price      Decimal
  recordedAt DateTime @map("recorded_at")

  @@map("price_history")
}

model ProductImage {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  product   Product  @relation(fields: [productId], references: [id])
  imageUrl  String   @map("image_url")
  main      Boolean
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("product_images")
}

model StoreCategory {
  id         String   @id @default(uuid())
  storeId    String   @map("store_id")
  store      Store    @relation(fields: [storeId], references: [id])
  categoryId String   @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id])
  url        String
  isActive   Boolean  @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("store_categories")
}

model ProductEmbedding {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  product   Product  @relation(fields: [productId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("product_embeddings")
}
